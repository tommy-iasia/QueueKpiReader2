# QueueKpiReader2
Read the KPI.txt generated by **com.iasia.util.KPI** in our *CommonUtility*.
![Preview](https://raw.githubusercontent.com/tommy-iasia/QueueKpiReader2/master/preview.png)

# Statistics
There are 4 statistical inputs per queue
- **addQueue**: counting queue items added to the queue
- **process**: counting items being run by executor
- **timewait**: timing items before running by executor
- **timeused**: timing items being run by executor

And there are 4 statistical outputs per queue
- **count**: number of count per minute/snapshot
- **totalCount**: total count from the birth of queue
- **duration**: number of millisecond timed per minute/snapshot
- **totalDuration**: total duration from the birth of queue

# Query
You are adviced to modify the **getLines** function in order to obtain your desired chart.
````
getLines = () => [
  {
    label: "Q-CMDFCASCADE-C.addQueue",
    data: getData("Q-CMDFCASCADE-C.addQueue", "totalCount"),
  },
  {
    label: "Q-CMDFCASCADE-C.process",
    data: getData("Q-CMDFCASCADE-C.process", "totalCount"),
  },
];

reload();
````
Directly edit the function in **developer console (F12)** and call **reload** to redraw the chart.

The key point is *getData* which extracts the property of a certain queue action.
````
getData("Q-CMDFCASCADE-C.addQueue", "totalCount")
````
| Queue ID | Action | Property|
|----------|--------|---------|
|Q-CMDFCASCADE-C|addQueue|totalCount|
|Q-CMDFCASCADE-C|process|totalCount|
|Q-CMDFCASCADE-C|addQueue|count|
|Q-CMDFCASCADE-C|process|count|
|Q-CMDFCASCADE-C|timewait|duration|
|Q-CMDFCASCADE-C|timeused|duration|
|Q-CMDFMSGPUB-S|addQueue|totalCount|
|Q-CMDFMSGPUB-S|process|totalCount|

Adjust the parameters according to your *kpi.txt*.

Filter data is easy. E.g. filter data by time:
````
getData("Q-CMDFCASCADE-C.addQueue", "totalCount").filter(t => t.x.getHours() >= 9)
````

# Analysis
The queue data usually come in pair, like *addQueue/process* and *timewait/timeused*. Since our executor executes items sequentially, items added may not be executed at once. Thus, items are in a life cycle:

| addQueue | > | timewait | > | process | > | timeused |
|----------|---|----------|---|---------|---|----------|

Counting the number of *addQueue* versus *process* gives you an insight of how queue item is accumulated inside the queue. The *timewait* and *timeused* pair shows how delay and blockage happen, in the satistics aspect.

> Usually, combining *kpi.txt* and *gc.log* and *NetInfo.txt* may give you a brief picture of resource consumption.
